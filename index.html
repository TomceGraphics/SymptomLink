<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocMatch | AI Health Assistant</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            /* Slate-50 */
            color: #0f172a;
            /* Slate-900 */
            -webkit-font-smoothing: antialiased;
        }

        /* Blue-tinted Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3b82f6;
        }

        /* Blue hover */

        /* Animations */
        .fade-in {
            animation: enter 0.2s ease-out;
        }

        @keyframes enter {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom Focus Ring for Inputs */
        .focus-ring:focus-within {
            border-color: #3b82f6;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen">

    <!-- PATIENT PORTAL -->
    <section id="patient-section" class="fade-in min-h-screen flex flex-col bg-slate-50">

        <!-- Hero Header -->
        <header class="w-full max-w-3xl mx-auto px-6 pt-24 pb-16 text-center">
            <!-- Badge -->
            <div
                class="inline-flex items-center rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700 mb-8">
                <i class="fas fa-sparkles mr-2 text-blue-500"></i>
                AI Triage Assistant
            </div>

            <h1 class="text-4xl font-extrabold tracking-tight lg:text-6xl text-slate-900 mb-6">
                How are you feeling?
            </h1>
            <p class="text-lg text-slate-500 leading-relaxed max-w-xl mx-auto mb-10">
                Describe your symptoms. We'll match you with the right care team instantly.
            </p>



            <!-- Main Input Area -->
            <div class="relative w-full max-w-2xl mx-auto z-30">
                <div
                    class="group relative flex flex-col rounded-3xl border border-slate-200 bg-white shadow-xl transition-all duration-300 focus-within:border-blue-400">

                    <!-- Text Area -->
                    <textarea id="symptomInput" placeholder="Describe your symptoms (e.g., sharp pain in lower back)..."
                        class="min-h-[80px] w-full resize-none bg-transparent px-6 py-5 text-base text-slate-700 placeholder:text-slate-400 focus:outline-none custom-scrollbar"
                        oninput="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px'"></textarea>

                    <!-- Footer Tools -->
                    <div class="flex items-center justify-between px-4 pb-3 pt-1">

                        <!-- LEFT TOOLS: Mic & Model Selector -->
                        <div class="flex items-center gap-2 relative">

                            <!-- Mic Button -->
                            <button
                                class="h-9 w-9 flex items-center justify-center rounded-full text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-all"
                                title="Voice Input">
                                <i class="fa-solid fa-microphone"></i>
                            </button>

                            <!-- Divider -->
                            <div class="h-4 w-px bg-slate-200 mx-1"></div>

                            <!-- MODEL TRIGGER BUTTON -->
                            <button onclick="toggleSearchMenu()" id="search-mode-btn"
                                class="group flex items-center gap-2 h-9 pl-3 pr-2.5 rounded-full text-xs font-semibold text-slate-600 bg-white border border-slate-200 hover:border-blue-300 hover:text-blue-600 transition-all shadow-sm">
                                <i id="mode-icon" class="fa-solid fa-wand-magic-sparkles text-blue-500"></i>
                                <span id="current-mode-text">Natural Language</span>
                                <i
                                    class="fas fa-chevron-up text-[10px] text-slate-400 group-hover:text-blue-500 transition-colors ml-1"></i>
                            </button>

                            <!-- MODEL POPOVER MENU (Hidden by default)-->
                            <div id="search-mode-menu"
                                class="hidden absolute bottom-[130%] left-0 w-[280px] bg-white rounded-2xl border border-slate-200 shadow-xl p-2 z-50 origin-bottom-left animate-in fade-in zoom-in-95 slide-in-from-bottom-1">

                                <!-- Menu Header -->
                                <div class="px-3 py-2 border-b border-slate-100 mb-1 flex justify-between items-center">
                                    <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Search
                                        Logic</span>
                                    <span
                                        class="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-medium">v2.1</span>
                                </div>

                                <!-- Option 1: AI (Default Active) -->
                                <button onclick="selectSearchMode('ai')" id="btn-mode-ai"
                                    class="w-full text-left p-2.5 rounded-xl flex items-start gap-3 mb-1 transition-all bg-blue-50/60 border border-blue-200/50 ring-1 ring-blue-100 relative overflow-hidden">
                                    <!-- Selection Indicator -->
                                    <div class="absolute right-2 top-2 text-blue-600" id="check-ai"><i
                                            class="fas fa-check-circle text-xs"></i></div>

                                    <div
                                        class="mt-0.5 w-8 h-8 rounded-lg bg-white text-blue-600 shadow-sm flex items-center justify-center flex-shrink-0 border border-blue-100">
                                        <i class="fa-solid fa-wand-magic-sparkles text-xs"></i>
                                    </div>
                                    <div>
                                        <div class="text-xs font-bold text-slate-800 flex items-center gap-2">
                                            Natural Language
                                        </div>
                                        <p class="text-[10px] text-slate-500 leading-normal mt-0.5 font-medium">Matches
                                            symptoms using natural language understanding with AI.</p>
                                    </div>
                                </button>

                                <!-- Option 2: Keyword -->
                                <button onclick="selectSearchMode('keyword')" id="btn-mode-keyword"
                                    class="w-full text-left p-2.5 rounded-xl flex items-start gap-3 transition-all hover:bg-slate-50 border border-transparent hover:border-slate-200 relative group">

                                    <!-- Selection Indicator (Hidden) -->
                                    <div class="absolute right-2 top-2 text-slate-400 opacity-0" id="check-keyword"><i
                                            class="fas fa-check-circle text-xs"></i></div>

                                    <div
                                        class="mt-0.5 w-8 h-8 rounded-lg bg-slate-50 text-slate-500 flex items-center justify-center flex-shrink-0 border border-slate-100 group-hover:bg-white group-hover:shadow-sm">
                                        <i class="fas fa-key text-xs"></i>
                                    </div>
                                    <div>
                                        <div class="text-xs font-bold text-slate-700">Keyword Match</div>
                                        <p class="text-[10px] text-slate-400 leading-normal mt-0.5 font-medium">Exact
                                            database matches. Faster, but strict.</p>
                                    </div>
                                </button>
                            </div>
                        </div>


                        <!-- RIGHT ACTION -->
                        <button onclick="triggerSearch()"
                            class="h-10 w-10 inline-flex items-center justify-center rounded-xl bg-slate-900 text-white shadow-md hover:bg-blue-600 transition-all duration-150 ease-out active:scale-95">
                            <i class="fa-solid fa-arrow-up"></i>
                        </button>


                    </div>
                </div>
            </div>

            <!-- Processing Status -->
            <div id="ai-status"
                class="mt-8 opacity-0 transition-opacity duration-300 flex justify-center items-center gap-2">
                <span class="relative flex h-3 w-3">
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-blue-600"></span>
                </span>
                <span class="text-xs font-bold text-blue-600 uppercase tracking-widest"
                    id="ai-status-text">Processing</span>
            </div>
        </header>

        <!-- Results Area -->
        <main class="flex-1 w-full max-w-6xl mx-auto px-6 pb-24">
            <div class="flex items-center justify-between mb-8 pb-4 border-b border-slate-200">
                <h2 class="text-xl font-bold tracking-tight text-slate-800">Suggested Specialists</h2>
                <div id="results-pill"
                    class="hidden md:flex items-center text-xs font-bold text-blue-700 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">
                    Database Ready
                </div>
            </div>

            <!-- Doctor Grid -->
            <div id="doctorGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards injected via JS -->
            </div>

            <!-- No Results -->
            <div id="no-results"
                class="hidden flex flex-col items-center justify-center py-20 text-center border-2 border-dashed border-slate-200 rounded-2xl bg-white/50">
                <div class="w-16 h-16 rounded-full bg-slate-50 flex items-center justify-center mb-4 text-slate-400">
                    <i class="fas fa-search text-2xl"></i>
                </div>
                <p class="text-slate-500 font-medium">No matches found for those symptoms.</p>
                <button onclick="showAllDoctors()" class="mt-2 text-sm font-bold text-blue-600 hover:underline">
                    View all doctors
                </button>
            </div>
        </main>
    </section>

    <!-- LOGIN SECTION -->
    <section id="login-section" class="hidden min-h-screen flex items-center justify-center p-4 bg-slate-50">
        <div class="w-full max-w-[400px] bg-white rounded-2xl border border-slate-200 shadow-lg overflow-hidden">
            <div class="p-8 text-center">
                <div
                    class="mx-auto w-12 h-12 bg-blue-50 text-blue-600 rounded-xl flex items-center justify-center mb-4">
                    <i class="fas fa-user-md text-xl"></i>
                </div>
                <h3 class="font-bold tracking-tight text-2xl text-slate-900">Provider Access</h3>
                <p class="text-sm text-slate-500 mt-2">Enter your credentials to continue.</p>
            </div>

            <div class="p-8 pt-0 space-y-4">
                <div class="space-y-2">
                    <label class="text-xs font-bold uppercase text-slate-400">Username</label>
                    <input type="text" id="login-user" placeholder="e.g. sarah" autocomplete="off"
                        class="flex h-11 w-full rounded-lg border border-slate-200 bg-transparent px-3 text-sm placeholder:text-slate-400 focus:outline-none focus:border-blue-500 transition-all">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-bold uppercase text-slate-400">Password</label>
                    <input type="password" id="login-pass" placeholder="••••••••" autocomplete="off"
                        class="flex h-11 w-full rounded-lg border border-slate-200 bg-transparent px-3 text-sm placeholder:text-slate-400 focus:outline-none focus:border-blue-500 transition-all">
                </div>

                <button onclick="handleLogin()"
                    class="w-full h-11 inline-flex items-center justify-center rounded-lg bg-blue-600 text-white font-semibold text-sm hover:bg-blue-700 transition-all">
                    Sign In
                </button>
                <p class="text-center text-xs text-slate-400 pt-2">Demo: sarah / 123 or admin / admin</p>
            </div>
        </div>
    </section>

    <!-- DOCTOR DASHBOARD -->
    <section id="doctor-dashboard" class="hidden fade-in min-h-screen bg-slate-50">
        <div class="max-w-6xl mx-auto px-6 py-12">
            <div class="flex flex-col md:flex-row md:items-end justify-between mb-10 gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900 tracking-tight" id="doc-dash-title">Welcome back</h1>
                    <p class="text-slate-500 mt-1">Here is your appointment schedule for today.</p>
                </div>
                <button onclick="logout()"
                    class="px-5 py-2.5 border border-slate-200 bg-white rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-50 hover:text-blue-600 transition-colors shadow-sm">
                    Log out
                </button>
            </div>

            <div class="grid grid-cols-1 gap-4" id="doctor-app-list">
                <!-- Appointments injected via JS -->
            </div>
        </div>
    </section>

    <!-- ADMIN PANEL -->
    <section id="admin-section" class="hidden fade-in min-h-screen bg-slate-50">
        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Admin Portal</h1>
                    <p class="text-slate-500 mt-1">System-wide matching overview.</p>
                </div>
                <div class="bg-white border border-slate-200 px-4 py-2 rounded-lg shadow-sm flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500"></div>
                    <span class="text-sm font-semibold text-slate-700">System Online</span>
                </div>
            </div>

            <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50 border-b border-slate-200">
                            <tr>
                                <th class="h-12 px-6 align-middle font-medium text-slate-500">Patient Name</th>
                                <th class="h-12 px-6 align-middle font-medium text-slate-500">Assigned Doctor</th>
                                <th class="h-12 px-6 align-middle font-medium text-slate-500">Time Slot</th>
                                <th class="h-12 px-6 text-right align-middle font-medium text-slate-500">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admin-table-body" class="divide-y divide-slate-100">
                            <!-- JS Rows -->
                        </tbody>
                    </table>
                </div>
                <div id="admin-empty" class="hidden py-12 text-center text-slate-400">
                    No active records found.
                </div>
            </div>
        </div>
    </section>

    <!-- BOOKING MODAL -->
    <div id="bookingModal" class="fixed inset-0 z-50 hidden">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>

        <!-- Modal Content -->
        <div
            class="fixed left-[50%] top-[50%] z-50 w-full max-w-[500px] translate-x-[-50%] translate-y-[-50%] bg-white shadow-2xl rounded-3xl border border-slate-100 animate-in zoom-in-95 duration-200 flex flex-col max-h-[90vh]">

            <!-- Header -->
            <div class="p-6 border-b border-slate-100 bg-slate-50/50 rounded-t-3xl">
                <h2 class="text-xl font-bold text-slate-900" id="modal-doc-name">Dr. Name</h2>
                <div class="flex items-center gap-2 mt-1">
                    <span class="text-sm font-semibold text-blue-600 bg-blue-50 px-2 py-0.5 rounded"
                        id="modal-doc-specialty">Specialty</span>
                    <span class="text-xs text-slate-400">• New Appointment</span>
                </div>
            </div>

            <!-- Scrollable Body -->
            <div class="p-6 overflow-y-auto custom-scrollbar space-y-6">

                <!-- 1. Patient Name -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wide">Patient Name</label>
                    <input id="form-name"
                        class="flex h-12 w-full rounded-xl border border-slate-200 bg-white px-4 text-base placeholder:text-slate-300 focus:outline-none focus:border-blue-500 transition-all"
                        placeholder="Enter full name" />
                </div>

                <!-- 2. Date Selection (Horizontal Scroll) -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wide">Select Date</label>
                    <div class="relative">
                        <!-- Gradient Fade for visual cue -->
                        <div
                            class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white to-transparent pointer-events-none z-10">
                        </div>

                        <div id="date-picker-container" class="flex gap-3 overflow-x-auto no-scrollbar pb-2 snap-x">
                            <!-- Dates injected by JS -->
                        </div>
                    </div>
                    <input type="hidden" id="selected-date-value">
                </div>

                <!-- 3. Time Selection (Grid) -->
                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wide">Available Time</label>
                    <div id="time-picker-container" class="grid grid-cols-3 sm:grid-cols-4 gap-3">
                        <!-- Times injected by JS -->
                    </div>
                    <input type="hidden" id="selected-time-value">
                </div>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t border-slate-100 bg-slate-50/50 rounded-b-3xl flex gap-3">
                <button onclick="closeModal()"
                    class="flex-1 h-12 rounded-xl border border-slate-200 bg-white text-sm font-bold text-slate-600 hover:bg-slate-100 transition-colors">
                    Cancel
                </button>
                <button onclick="submitBooking()"
                    class="flex-1 h-12 rounded-xl bg-blue-600 text-sm font-bold text-white hover:bg-blue-700 active:scale-95 transition-all">
                    Confirm Match
                </button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed bottom-6 right-6 z-[100] hidden translate-y-10 opacity-0 transition-all duration-300">
        <div id="toast-container"
            class="flex flex-col gap-3 rounded-xl border border-slate-200 bg-white px-6 py-4 shadow-lg min-w-[300px]">
            <div class="flex items-center gap-3">
                <div id="toast-icon-bg"
                    class="flex h-8 w-8 items-center justify-center rounded-full bg-blue-50 text-blue-600">
                    <i id="toast-icon" class="fas fa-check text-sm"></i>
                </div>
                <div>
                    <h4 id="toast-title" class="text-sm font-bold text-slate-900">Success</h4>
                    <p class="text-xs text-slate-500" id="toast-msg">Booking confirmed.</p>
                </div>
            </div>
            <div id="toast-actions" class="hidden flex gap-2 mt-2">
                <button id="toast-cancel"
                    class="flex-1 px-3 py-1.5 text-xs font-bold text-slate-500 hover:bg-slate-100 rounded-lg transition-colors">Cancel</button>
                <button id="toast-ok"
                    class="flex-1 px-3 py-1.5 text-xs font-bold text-white bg-orange-500 hover:bg-orange-600 rounded-lg transition-colors">OK</button>
            </div>
        </div>
    </div>

    <!-- Main Application Logic -->
    <script src="script.js"></script>
</body>

</html>